<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BODEGA</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

<!-- HOME -->
<main id="homeScreen" class="screen">
  <h1 style="text-align: center;">BODEGA</h1>
  <div class="home-grid">
    <button id="btnMix" class="big-btn">MEZCLAS DE VINOS</button>
    <button id="btnMov" class="big-btn alt2">MOVIMIENTOS BODEGA</button>
    <button id="btnBodega" class="big-btn alt2">DEP√ìSITOS BODEGA</button>
    <button id="btnMapa" class="big-btn alt2">MAPA DEP√ìSITOS</button>
    <button id="btnBarricas" class="big-btn alt2">BARRICAS</button>
    <button id="btnSalaBarr" class="big-btn alt2">SALA BARRICAS</button>
    <button id="btnSO2" class="big-btn alt">CORRECCI√ìN SO‚ÇÇ</button>
    <button id="btnProducts" class="big-btn alt2">C√ÅLCULOS EN√ìLOGICOS</button>
    <button id="btnNotes" class="big-btn alt2">BLOCKS DE NOTAS</button>
  </div>
  <div class="backup-row">
  <button id="exportBackup">üíæ EXPORTAR</button>
  <button id="importBackup">üìÇ IMPORTAR</button>
</div>
<input type="file" id="backupFile" accept=".json" hidden>

</main>

<!-- MEZCLAS -->
<section id="mixScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">‚Üê Volver</button>
    <h2>MEZCLAS DE VINOS</h2>
  </header>
  <div class="card">
    <div class="controls">
      <button id="addMixRow" class="small">A√±adir Fila</button>
      <div class="inline-info">Total Volumen: <strong><span id="mixTotal">0</span> L</strong></div>
    </div>
    <table class="table" id="mixTable">
      <thead class="thead-green">
        <tr>
          <th>DEP√ìSITO</th>
          <th>MEZCLA <br>(%)</th>
          <th>VOLUMEN (L)</th>
          <th>GRADO (%)</th>
          <th><span style="text-transform:lowercase;">p</span>H (UD)</th>
          <th>ACIDEZ (<span style="text-transform:lowercase;">g</span>/L)</th>
          <th>ACCI√ìN</th>
        </tr>
      </thead>
      <tbody id="mixTableBody"></tbody>
    </table>

    <label class="label-green">Dep√≥sito Final</label>
    <input id="mixFinalDeposit" type="text" placeholder="Ej: Dep√≥sito 5">

    <div class="actions">
      <button id="calcMix">Calcular Mezcla</button>
      <button id="exportMixExcel">Exportar Excel</button>
      <button id="exportMixPDF">Exportar PDF</button>
      <button id="saveMix" class="small">Guardar</button>
    </div>

    <div id="mixResults" class="results"></div>
  </div>
</section>

<!-- MOVIMIENTOS BODEGA -->
<section id="movScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">‚Üê Volver</button>
    <h2>MOVIMIENTOS BODEGA</h2>
  </header>

  <div class="card">
    <div class="controls">
      <button id="addMovRow" class="small">A√±adir Fila</button>
      <button id="sendSelected" class="small">Enviar selecci√≥n</button>
      <div class="inline-info">Filas: <strong><span id="movCount">0</span></strong></div>
      <div style="margin-left:10px"><button id="gen300" class="small">Generar hasta 400</button></div>
    </div>

    <table class="table" id="movTable">
      <thead class="thead-green">
        <tr>
          <th><input id="selectAllMov" type="checkbox" title="Seleccionar todo"></th>
          <th>N¬∫</th>
          <th>Origen</th>
          <th>Destino</th>
          <th>Movimientos<br>(L<span style="text-transform:lowercase;">itros</span>)</th>
          <th>Fecha</th>
          <th>Observaciones</th>
          <th>Estado</th>
          <th>Acci√≥n</th>
        </tr>
      </thead>
      <tbody id="movTableBody"></tbody>
    </table>

    <div class="actions">
      <button id="exportMovExcel">Exportar Excel</button>
      <button id="exportMovPDF">Exportar PDF</button>
      <button id="saveMov" class="small">Guardar</button>
    </div>

    <div id="movResults" class="results"></div>
  </div>
</section>

<!-- BODEGA -->
<section id="bodegaScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">‚Üê Volver</button>
    <h2>DEP√ìSITOS BODEGA</h2>
  </header>

  <div class="card">
    <div class="controls" style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <button id="exportBodegaExcel">Exportar Excel</button>
        <button id="exportBodegaPDF">Exportar PDF</button>
        <button id="saveBodega" class="small">Guardar</button>
      </div>
      <div>
        <button id="openMapaFromBodega" class="small">Ver Mapa</button>
      </div>
    </div>

    <table class="table" id="bodegaTable">
      <thead class="thead-green">
        <tr>
          <th>DEP√ìSITO</th>
          <th>CAPACIDAD <br>(L<span style="text-transform:lowercase;">itros</span>)</th>
          <th>VOLUMEN <br>
            ACTUAL (L)</th>
          <th>GRADO (%)</th>
          <th><span style="text-transform:lowercase;">p</span>H (Ud)</th>
          <th>ACIDEZ <br>
            (<span style="text-transform:lowercase;">g</span>/L)</th>
          <th>TIPO VINO</th>
          <th>A√ëADAS</th>
          <th>SO‚ÇÇ <br>
            LIBRE</Li></th>
          <th class="col-carac">CARACTER√çSTICAS</th>
        </tr>
      </thead>
      <tbody id="bodegaTableBody"></tbody>
    </table>

    <div id="bodegaResults" class="results"></div>
  </div>
</section>

<!-- MAPA DE DEP√ìSITOS -->
<section id="mapaScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">‚Üê Volver</button>
    <h2>MAPA DE DEP√ìSITOS</h2>
  </header>

  <div class="card">
    <div class="controls" style="justify-content:space-between;align-items:center;">
      <button id="refreshMapa" class="small">Refrescar Mapa</button>
      <div class="inline-info">Haz clic en un dep√≥sito para ir a su fila en Bodega</div>
    </div>

    <div id="mapContainer" class="map-container" aria-live="polite"></div>

    <div class="actions" style="margin-top:14px">
      <button id="exportMapaPNG" class="small">Exportar JPG</button>
      <button id="exportMapaPDF" class="small">Exportar PDF</button>
    </div>
  </div>
</section>

<!-- BARRICAS -->
<section id="barricasScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">‚Üê Volver</button>
    <h2>BARRICAS</h2>
  </header>

  <div class="card">
    <div class="controls">
      <button id="addBarrRow" class="small">A√±adir Fila</button>
      <div class="inline-info">Total Barricas: <strong><span id="barrCount">0</span></strong> ‚Äî Total Litros: <strong><span id="barrLitros">0</span> L</strong></div>
    </div>

    <table class="table" id="barrTable">
      <thead class="thead-green">
        <tr>
          <th>Barricas</th>
          <th>CAPACIDAD <br>(L<span style="text-transform:lowercase;">itros</span>)</th>
          <th>Litros <br> Barricas</th>
          <th>A√±ada</th>
          <th>Fecha Entrada</th>
          <th>Crianza <br>(M<span style="text-transform:lowercase;">eses</span>)</th>
          <th>Observaciones</th>
          <th>TIPO VINO (MARCA)</th>
          <th>COLOR</th>
          <th>Acci√≥n</th>
        </tr>
      </thead>
      <tbody id="barrTableBody"></tbody>
    </table>

    <div class="actions">
      <button id="exportBarrExcel">Exportar Excel</button>
      <button id="exportBarrPDF">Exportar PDF</button>
      <button id="saveBarr" class="small">Guardar</button>
    </div>

    <div id="barrResults" class="results"></div>
  </div>
</section>

<!-- SALA BARRICAS (nueva) -->
<section id="salaBarrScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">‚Üê Volver</button>
    <h2>SALA DE BARRICAS</h2>
  </header>

  <div class="card">
    <div class="controls" style="gap:8px;align-items:center;">
      <div class="sala-tabs">
        <button class="small sala-btn" data-sala="1">Sala 1 (Principal)</button>
        <button class="small sala-btn" data-sala="2">Sala 2 (Visitas)</button>
        <button class="small sala-btn" data-sala="3">Sala 3 (Nave Placas)</button>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
        <button id="exportSalaJPG" class="small">Exportar JPG</button>
        <button id="exportSalaPDF" class="small">Exportar PDF</button>
        <button id="clearSala" class="small">Borrar Sala</button>
      </div>
    </div>

    <div class="sala-layout">
      <aside class="sala-panel">
        <h4>Panel de Barricas (arrastrar)</h4>
        <div id="palette" class="palette"></div>
        <div style="margin-top:10px">
          <button id="clearCell" class="small">Vaciar casilla</button>
        <button id="removeOne" class="small">Quitar 1</button>
        </div>
      </aside>

     <div class="sala-main">
      

  <div id="salaInfo" class="inline-info sala-title">
    Sala <strong id="salaNumber">1</strong>
  </div>

  <div class="sala-grid-wrap">
  <div id="salaGrid" class="sala-grid" aria-label="Grid sala"></div>
</div>
<div id="panel-totales-barricas" class="card" style="margin-top:16px;text-align:center;">
  <div id="total-sala-actual" style="font-weight:800;font-size:16px;"></div>
  <div id="total-global" style="margin-top:6px;font-weight:800;"></div>
</div>

</div>

  </div>
</section>

<!-- SO2 -->
<section id="so2Screen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">‚Üê Volver</button>
    <h2>CORRECCI√ìN SO‚ÇÇ</h2>
  </header>

  <div class="card narrow">
    <label class="label-green">Volumen (L)</label>
    <input id="so2Volume" type="number" step="0.01">

    <button id="useMixVolume" class="small">USAR VOLUMEN MEZCLAS</button>

    <label class="label-green">SO‚ÇÇ Actual (<span style="text-transform:lowercase;">mg</span>/L)</label>
    <input id="so2Actual" type="number" step="0.01">

    <label class="label-green">SO‚ÇÇ Objetivo (<span style="text-transform:lowercase;">mg</span>/L)</label>
    <input id="so2Target" type="number" step="0.01">

    <label class="label-green">Porcentaje Solfosol M (%)</label>
    <input id="so2Percent" type="number" step="0.01" value="23.8">

    <div class="actions">
      <button id="calcSO2">Calcular Sulfuroso</button>
      <button id="exportSO2Excel">Exportar Excel</button>
      <button id="exportSO2PDF">Exportar PDF</button>
      <button id="saveSO2" class="small">Guardar</button>
    </div>

    <div id="so2Results" class="results"></div>
  </div>
</section>

<!-- PRODUCTOS -->
<section id="productsScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">‚Üê Volver</button>
    <h2>PRODUCTOS EN√ìLOGICOS</h2>
  </header>

  <div class="card">
    <div class="controls">
      <h2>C√ÅLCULO DE PRODUCTOS</h2>
      <button id="addProdRow" class="small">A√±adir Fila</button>
    </div>
    
    <table class="table" id="prodTable">
      <thead class="thead-green">
        <tr>
          <th>PRODUCTOS</th>
          <th>Dosis (<span style="text-transform:lowercase;">g</span>/<span style="text-transform:lowercase;">h</span>L)</th>
          <th>Litros (L)</th>
          <th>hL</th>
          <th>Cantidad (K<span style="text-transform:lowercase;">g o</span> L)</th>
          <th>Acci√≥n</th>
        </tr>
      </thead>
      <tbody id="prodTableBody"></tbody>
    </table>

    <div class="actions">
      <button id="exportProdExcel">Exportar Excel</button>
      <button id="exportProdPDF">Exportar PDF</button>
      <button id="saveProd" class="small">Guardar</button>
    </div>

    <div class="card" style="margin-top:14px">
      <div class="controls">
        <h2>C√ÅLCULO DE √ÅCIDO L√ÅCTICO</h2>
        <button id="addLacticRow" class="small">A√±adir Fila</button>
      </div>
      
      <table class="table" id="acidLacticTable">
        <thead class="thead-green">
          <tr>
            <th>Producto</th>
            <th>Porcentaje <br>(%)</th>
            <th>Acidez Actual <br>(<span style="text-transform:lowercase;">g</span>/L)</th>
            <th>Acidez Objetivo<br>(<span style="text-transform:lowercase;">g</span>/L)</th>
            <th>Dosis <br>(<span style="text-transform:lowercase;">g</span>/L)</th></th>
            <th>Volumen (L)</th>
            <th>Resultado (L)</th>
            <th>Acci√≥n</th>
          </tr>
        </thead>
        <tbody id="acidLacticBody"></tbody>
      </table>

      <div class="actions">
        <button id="exportLacticExcel">Exportar Excel</button>
        <button id="exportLacticPDF">Exportar PDF</button>
        <button id="saveLactic" class="small">Guardar</button>
      </div>
    </div>

    <div id="prodResults" class="results"></div>
  </div>
</section>

<script src="script.js"></script>
<script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>


<!-- BLOCKS DE NOTAS -->
<section id="notesScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">‚Üê Volver</button>
    <h2>BLOCKS DE NOTAS</h2>
  </header>

  <div class="card">
  <!-- Buscador de notas -->
<div style="display:flex; gap:5px; margin-bottom:10px;">
  <input type="text" id="searchNotes" placeholder="Buscar notas por t√≠tulo..." style="flex:1; padding:5px;">
  <button id="btnSearchNotes">Buscar</button>
</div>


    <!-- Editor de nota -->
    <input type="text" id="noteTitle" placeholder="T√≠tulo de la nota" style="width:100%;margin-bottom:5px;padding:5px;">
    <textarea id="notesText" placeholder="Escribe tu nota aqu√≠..." style="width:100%;min-height:200px;margin-bottom:10px;padding:5px;"></textarea>

    <!-- Acciones -->
    <div class="actions">
      <button id="saveNotes">Guardar</button>
      <button id="exportNotesPDF">Exportar PDF</button>
      <button id="clearNotes">Borrar</button>
    </div>

    <!-- Lista de notas -->
    <div id="notesList" style="margin-top:15px;"></div>
  </div>
</section>
</body>
</html>