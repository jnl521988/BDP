<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>BODEGA</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
</head>
<body>

<!-- HOME -->
<main id="homeScreen" class="screen">
  <h1 style="text-align: center;">BODEGA</h1>
  <div class="home-grid">
    <button id="btnMix" class="big-btn">MEZCLAS DE VINOS</button>
    <button id="btnMov" class="big-btn alt2">MOVIMIENTOS BODEGA</button>
    <button id="btnBodega" class="big-btn alt2">DEPÓSITOS BODEGA</button>
    <button id="btnMapa" class="big-btn alt2">MAPA DEPÓSITOS</button>
    <button id="btnBarricas" class="big-btn alt2">BARRICAS</button>
    <button id="btnSalaBarr" class="big-btn alt2">SALA BARRICAS</button>
    <button id="btnSO2" class="big-btn alt">CORRECCIÓN SO₂</button>
    <button id="btnProducts" class="big-btn alt2">CÁLCULOS ENÓLOGICOS</button>
    <button id="btnNotes" class="big-btn alt2">BLOCKS DE NOTAS</button>
  </div>
</main>

<!-- MEZCLAS -->
<section id="mixScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">← Volver</button>
    <h2>MEZCLAS DE VINOS</h2>
  </header>
  <div class="card">
    <div class="controls">
      <button id="addMixRow" class="small">Añadir Fila</button>
      <div class="inline-info">Total Volumen: <strong><span id="mixTotal">0</span> L</strong></div>
    </div>
    <table class="table" id="mixTable">
      <thead class="thead-green">
        <tr>
          <th>DEPÓSITO</th>
          <th>MEZCLA <br>(%)</th>
          <th>VOLUMEN (L)</th>
          <th>GRADO (%)</th>
          <th><span style="text-transform:lowercase;">p</span>H (UD)</th>
          <th>ACIDEZ (<span style="text-transform:lowercase;">g</span>/L)</th>
          <th>ACCIÓN</th>
        </tr>
      </thead>
      <tbody id="mixTableBody"></tbody>
    </table>

    <label class="label-green">Depósito Final</label>
    <input id="mixFinalDeposit" type="text" placeholder="Ej: Depósito 5">

    <div class="actions">
      <button id="calcMix">Calcular Mezcla</button>
      <button id="exportMixCSV">Exportar CSV</button>
      <button id="exportMixPDF">Exportar PDF</button>
      <button id="saveMix" class="small">Guardar</button>
    </div>

    <div id="mixResults" class="results"></div>
  </div>
</section>

<!-- MOVIMIENTOS BODEGA -->
<section id="movScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">← Volver</button>
    <h2>MOVIMIENTOS BODEGA</h2>
  </header>

  <div class="card">
    <div class="controls">
      <button id="addMovRow" class="small">Añadir Fila</button>
      <button id="sendSelected" class="small">Enviar selección</button>
      <div class="inline-info">Filas: <strong><span id="movCount">0</span></strong></div>
      <div style="margin-left:10px"><button id="gen300" class="small">Generar hasta 400</button></div>
    </div>

    <table class="table" id="movTable">
      <thead class="thead-green">
        <tr>
          <th><input id="selectAllMov" type="checkbox" title="Seleccionar todo"></th>
          <th>Número<br>Movimiento</th>
          <th>Depósito<br>Origen</th>
          <th>Depósito<br>Destino</th>
          <th>Litros</th>
          <th>Fecha</th>
          <th>Observaciones</th>
          <th>Estado</th>
          <th>Acción</th>
        </tr>
      </thead>
      <tbody id="movTableBody"></tbody>
    </table>

    <div class="actions">
      <button id="exportMovCSV">Exportar CSV</button>
      <button id="exportMovPDF">Exportar PDF</button>
      <button id="saveMov" class="small">Guardar</button>
    </div>

    <div id="movResults" class="results"></div>
  </div>
</section>

<!-- BODEGA -->
<section id="bodegaScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">← Volver</button>
    <h2>DEPÓSITOS BODEGA</h2>
  </header>

  <div class="card">
    <div class="controls" style="display:flex;justify-content:space-between;align-items:center;">
      <div>
        <button id="exportBodegaCSV">Exportar CSV</button>
        <button id="exportBodegaPDF">Exportar PDF</button>
        <button id="saveBodega" class="small">Guardar</button>
      </div>
      <div>
        <button id="openMapaFromBodega" class="small">Ver Mapa</button>
      </div>
    </div>

    <table class="table" id="bodegaTable">
      <thead class="thead-green">
        <tr>
          <th>DEPÓSITO</th>
          <th>CAPACIDAD <br>(L<span style="text-transform:lowercase;">itros</span>)</th>
          <th>VOLUMEN <br>
            ACTUAL (L)</th>
          <th>GRADO (%)</th>
          <th><span style="text-transform:lowercase;">p</span>H (Ud)</th>
          <th>ACIDEZ <br>
            (<span style="text-transform:lowercase;">g</span>/L)</th>
          <th>TIPO VINO</th>
          <th>AÑADAS</th>
          <th>SO₂ <br>
            LIBRE</Li></th>
          <th class="col-carac">CARACTERÍSTICAS</th>
        </tr>
      </thead>
      <tbody id="bodegaTableBody"></tbody>
    </table>

    <div id="bodegaResults" class="results"></div>
  </div>
</section>

<!-- MAPA DE DEPÓSITOS -->
<section id="mapaScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">← Volver</button>
    <h2>MAPA DE DEPÓSITOS</h2>
  </header>

  <div class="card">
    <div class="controls" style="justify-content:space-between;align-items:center;">
      <button id="refreshMapa" class="small">Refrescar Mapa</button>
      <div class="inline-info">Haz clic en un depósito para ir a su fila en Bodega</div>
    </div>

    <div id="mapContainer" class="map-container" aria-live="polite"></div>

    <div class="actions" style="margin-top:14px">
      <button id="exportMapaPNG" class="small">Exportar JPG</button>
      <button id="exportMapaPDF" class="small">Exportar PDF</button>
    </div>
  </div>
</section>

<!-- BARRICAS -->
<section id="barricasScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">← Volver</button>
    <h2>BARRICAS</h2>
  </header>

  <div class="card">
    <div class="controls">
      <button id="addBarrRow" class="small">Añadir Fila</button>
      <div class="inline-info">Total Barricas: <strong><span id="barrCount">0</span></strong> — Total Litros: <strong><span id="barrLitros">0</span> L</strong></div>
    </div>

    <table class="table" id="barrTable">
      <thead class="thead-green">
        <tr>
          <th>Barricas</th>
          <th>CAPACIDAD <br>(L<span style="text-transform:lowercase;">itros</span>)</th>
          <th>Litros <br> Barricas</th>
          <th>Añada</th>
          <th>Fecha Entrada</th>
          <th>Observaciones</th>
          <th class="col-vino">Tipo Vino (Marca)</th>
          <th>Código</th>
          <th>COLOR</th>
          <th>Acción</th>
        </tr>
      </thead>
      <tbody id="barrTableBody"></tbody>
    </table>

    <div class="actions">
      <button id="exportBarrCSV">Exportar CSV</button>
      <button id="exportBarrPDF">Exportar PDF</button>
      <button id="saveBarr" class="small">Guardar</button>
    </div>

    <div id="barrResults" class="results"></div>
  </div>
</section>

<!-- SALA BARRICAS (nueva) -->
<section id="salaBarrScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">← Volver</button>
    <h2>SALA DE BARRICAS</h2>
  </header>

  <div class="card">
    <div class="controls" style="gap:8px;align-items:center;">
      <div class="sala-tabs">
        <button class="small sala-btn" data-sala="1">Sala 1 (Principal)</button>
        <button class="small sala-btn" data-sala="2">Sala 2 (Visitas)</button>
        <button class="small sala-btn" data-sala="3">Sala 3 (Nave Placas)</button>
      </div>
      <div style="margin-left:auto;display:flex;gap:8px;align-items:center;">
        <button id="exportSalaJPG" class="small">Exportar JPG</button>
        <button id="exportSalaPDF" class="small">Exportar PDF</button>
        <button id="clearSala" class="small">Borrar Sala</button>
      </div>
    </div>

    <div class="sala-layout">
      <aside class="sala-panel">
        <h4>Panel de Barricas (arrastrar)</h4>
        <div id="palette" class="palette"></div>
        <div style="margin-top:10px">
          <button id="clearCell" class="small">Vaciar casilla</button>
        <button id="removeOne" class="small">Quitar 1</button>
        </div>
      </aside>

     <div class="sala-main">

  <div id="salaInfo" class="inline-info sala-title">
    Sala <strong id="salaNumber">1</strong>
  </div>

  <div class="sala-grid-wrap">
  <div id="salaGrid" class="sala-grid" aria-label="Grid sala"></div>
</div>

</div>

  </div>
</section>

<!-- SO2 -->
<section id="so2Screen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">← Volver</button>
    <h2>CORRECCIÓN SO₂</h2>
  </header>

  <div class="card narrow">
    <label class="label-green">Volumen (L)</label>
    <input id="so2Volume" type="number" step="0.01">

    <button id="useMixVolume" class="small">USAR VOLUMEN MEZCLAS</button>

    <label class="label-green">SO₂ Actual (<span style="text-transform:lowercase;">mg</span>/L)</label>
    <input id="so2Actual" type="number" step="0.01">

    <label class="label-green">SO₂ Objetivo (<span style="text-transform:lowercase;">mg</span>/L)</label>
    <input id="so2Target" type="number" step="0.01">

    <label class="label-green">Porcentaje Solfosol M (%)</label>
    <input id="so2Percent" type="number" step="0.01" value="23.8">

    <div class="actions">
      <button id="calcSO2">Calcular Sulfuroso</button>
      <button id="exportSO2CSV">Exportar CSV</button>
      <button id="exportSO2PDF">Exportar PDF</button>
      <button id="saveSO2" class="small">Guardar</button>
    </div>

    <div id="so2Results" class="results"></div>
  </div>
</section>

<!-- PRODUCTOS -->
<section id="productsScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">← Volver</button>
    <h2>PRODUCTOS ENÓLOGICOS</h2>
  </header>

  <div class="card">
    <div class="controls">
      <h2>CÁLCULO DE PRODUCTOS</h2>
      <button id="addProdRow" class="small">Añadir Fila</button>
    </div>
    
    <table class="table" id="prodTable">
      <thead class="thead-green">
        <tr>
          <th>PRODUCTOS</th>
          <th>Dosis (<span style="text-transform:lowercase;">g</span>/<span style="text-transform:lowercase;">h</span>L)</th>
          <th>Litros (L)</th>
          <th>hL</th>
          <th>Cantidad (K<span style="text-transform:lowercase;">g o</span> L)</th>
          <th>Acción</th>
        </tr>
      </thead>
      <tbody id="prodTableBody"></tbody>
    </table>

    <div class="actions">
      <button id="exportProdCSV">Exportar CSV</button>
      <button id="exportProdPDF">Exportar PDF</button>
      <button id="saveProd" class="small">Guardar</button>
    </div>

    <div class="card" style="margin-top:14px">
      <div class="controls">
        <h2>CÁLCULO DE ÁCIDO LÁCTICO</h2>
        <button id="addLacticRow" class="small">Añadir Fila</button>
      </div>
      
      <table class="table" id="acidLacticTable">
        <thead class="thead-green">
          <tr>
            <th>Producto</th>
            <th>Porcentaje <br>(%)</th>
            <th>Acidez Actual <br>(<span style="text-transform:lowercase;">g</span>/L)</th>
            <th>Acidez Objetivo<br>(<span style="text-transform:lowercase;">g</span>/L)</th>
            <th>Dosis <br>(<span style="text-transform:lowercase;">g</span>/L)</th></th>
            <th>Volumen (L)</th>
            <th>Resultado (L)</th>
            <th>Acción</th>
          </tr>
        </thead>
        <tbody id="acidLacticBody"></tbody>
      </table>

      <div class="actions">
        <button id="exportLacticCSV">Exportar CSV</button>
        <button id="exportLacticPDF">Exportar PDF</button>
        <button id="saveLactic" class="small">Guardar</button>
      </div>
    </div>

    <div id="prodResults" class="results"></div>
  </div>
</section>

<script src="script.js"></script>

<!-- BLOCKS DE NOTAS -->
<section id="notesScreen" class="screen hidden">
  <header class="screen-header">
    <button class="btn-back">← Volver</button>
    <h2>BLOCKS DE NOTAS</h2>
  </header>
  <div class="card">
    <textarea id="notesText" style="width:100%;min-height:300px"></textarea>
    <div class="actions">
      <button id="saveNotes">Guardar</button>
      <button id="exportNotesPDF">Exportar PDF</button>
      <button id="clearNotes" class="small">Borrar</button>
    </div>
  </div>
</section>
</body>
</html>